Proof of concept for retrieving sequence files (sam, bam, cram) via a streaming service

Dowload additional js dependencies
npm install mongodb

Connect to iRODs if needed'

Run server on the default port 9444
bin/server.js

Run server on a custom port 9447
bin/server.js 9447

Queries:
curl -H "Content-type: application/octet-stream" -X "GET" 'localhost:9444/sample?region=Zv9_scaffold3541&accession=ERS1023809'
  no files found - an empty reply
  one file found - an outcome of samtools view
  multiple files found - an outcome of samtools merge

curl -H "Content-type: application/octet-stream" -X "GET" 'localhost:9444/file?directory=/seq/18691&region=Zv9_scaffold3541&irods=1&name=18691_1%231.cram'
curl -H "Content-type: application/octet-stream" -X "GET" 'localhost:9444/file?directory=/staging/path&region=Zv9_scaffold3541&name=18691_1%231.cram'

The 'region' option can be specified multiple times.

The default output format is bam. Use 'format' option with value either 'sam' or 'bam' or 'cram' to change the output format.



TODO LIST
=========

Client disconnects - any action on the server side to set up?

Trailer header is used to communicate that an error occured durin gthe data transmission, ie after the headers have been sent. CURL does not understand trailers. It is possible to build a nodejs HTTP client that understands trailers.

It is possible to dynamically compute md5 and send it in a trailer.




