Proof of concept for retrieving sequence files (sam, bam, cram) via a streaming service

Dowload additional js dependencies
npm install mongodb

Connect to iRODs if needed'

Run server on the default port 9444
bin/server.js

Run server on a custom port 9447
bin/server.js 9447

Queries:
curl -H "Content-type: application/octet-stream" -X "GET" 'localhost:9444/sample?region=Zv9_scaffold3541&accession=ERS1023809'
  no files found - an empty reply
  one file found - an outcome of samtools view
  multiple files found - an outcome of samtools merge

curl -H "Content-type: application/octet-stream" -X "GET" 'localhost:9444/file?directory=/seq/18691&region=Zv9_scaffold3541&irods=1&name=18691_1%231.cram'
curl -H "Content-type: application/octet-stream" -X "GET" 'localhost:9444/file?directory=/staging/path&region=Zv9_scaffold3541&name=18691_1%231.cram'

The 'region' option can be specified multiple times.

The default output format is bam. Use 'format' option with value either 'sam' or 'bam' or 'cram' to change the output format.



TODO LIST
=========

Client disconnects - any action on the server side to set up?
markdups errors mid-stream. the code is 200 OK. Anything to output to the stream to say that it is truncated?

chunked encoding is used - how we ensure that we do not have -he terminating 0-length chunk at the end of the response - might help teh client to realise that the data were truncated



